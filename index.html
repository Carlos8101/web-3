<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
let datos = [];
const PASSWORD_ADMIN = "rifa2025"; // Cambia la contraseÃ±a

// Mostrar secciÃ³n
function mostrar(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if (id === "boletos") cargarBoletos();
  if (id === "admin") cargarAdmin();
}

// Acceso Admin
function accesoAdmin() {
  const pass = prompt("ContraseÃ±a de administrador:");
  if (pass === PASSWORD_ADMIN) {
    mostrar('admin');
  } else {
    alert("Acceso denegado");
  }
}

// Registrar boleto
function registrar() {
  const nombre = document.getElementById("nombre").value;
  const telefono = document.getElementById("telefono").value;
  const boleto = document.getElementById("boleto").value.padStart(4,"0");

  if (!nombre || !telefono || boleto < "0001" || boleto > "10000") {
    alert("Datos invÃ¡lidos");
    return;
  }

  if (datos.some(d => d.boleto === boleto)) {
    alert("Boleto ocupado");
    return;
  }

  datos.push({ boleto, nombre, telefono });

  const blob = new Blob([JSON.stringify(datos,null,2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "boletos.json";
  a.click();

  alert("Registro hecho. Reemplaza el archivo en GitHub.");
}

// Cargar boletos
function cargarBoletos() {
  const cont = document.getElementById("listaBoletos");
  cont.innerHTML = "";
  const ocupados = datos.map(d => d.boleto);

  for (let i = 1; i <= 10000; i++) {
    const b = i.toString().padStart(4,"0");
    const div = document.createElement("div");
    div.className = "boleto" + (ocupados.includes(b) ? " ocupado" : "");
    div.textContent = b;
    cont.appendChild(div);
  }
}

// Cargar tabla Admin
function cargarAdmin() {
  const tabla = document.getElementById("tabla");
  tabla.innerHTML = "";
  datos.forEach(d => {
    tabla.innerHTML += `
      <tr>
        <td>${d.boleto}</td>
        <td>${d.nombre}</td>
        <td>${d.telefono}</td>
      </tr>`;
  });
}

// Sortear ganador
function sortear() {
  if (datos.length === 0) return alert("No hay boletos");
  const g = datos[Math.floor(Math.random() * datos.length)];
  document.getElementById("ganador").innerText =
    `ðŸŽ‰ Ganador: Boleto ${g.boleto} - ${g.nombre}`;
}

// Exportar Excel
function exportar() {
  const ws = XLSX.utils.json_to_sheet(datos);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Rifa");
  XLSX.writeFile(wb, "rifa.xlsx");
}

// Cargar datos iniciales
async function cargarDatos() {
  try {
    const res = await fetch("boletos.json");
    datos = await res.json();
  } catch (e) {
    datos = [];
  }
}
cargarDatos();
</script>

</body>
</html>

